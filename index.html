<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Portal Aktiviti ISMA Subang Jaya</title>
    
    <!-- React & Babel CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin="anonymous"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding: 0; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-[#FDFCF8]">
    <div id="root">
        <div class="flex items-center justify-center min-h-screen text-center">
            <div>
                <div class="w-12 h-12 border-4 border-teal-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                <p class="text-teal-800 font-bold animate-pulse text-xs tracking-widest uppercase">Menyambung ke Portal...</p>
            </div>
        </div>
    </div>

    <script type="text/babel" data-presets="react">
        const { useState, useEffect, useMemo, useCallback } = React;

        // ==========================================
        // KONFIGURASI UTAMA
        // ==========================================
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwSgOsEzGXzG25VBDpWROT3QlFQca_yoN80NeyGVM0dIzYjYT3_bMGNfZUW6eD2xd_Q/exec"; 
        const COMMUNITY_PASSCODE = "ISMA-SJ-2026"; 
        const LOGO_URL ="https://i.imgur.com/PweAKvQ.png"; 

        const Icon = ({ name, size = 20, className = "" }) => {
            const paths = {
                plus: <path d="M5 12h14m-7-7v14"/>,
                grid: <React.Fragment><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></React.Fragment>,
                list: <React.Fragment><line x1="8" x2="21" y1="6" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><circle cx="3" cy="6" r="1"/><circle cx="3" cy="12" r="1"/><circle cx="3" cy="18" r="1"/></React.Fragment>,
                send: <React.Fragment><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></React.Fragment>,
                calendar: <React.Fragment><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></React.Fragment>,
                users: <React.Fragment><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></React.Fragment>,
                check: <path d="M20 6 9 17l-5-5"/>,
                upload: <React.Fragment><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></React.Fragment>,
                refresh: <React.Fragment><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.85.83 6.72 2.24L21 8"/><path d="M21 3v5h-5"/></React.Fragment>,
                info: <React.Fragment><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></React.Fragment>,
                x: <React.Fragment><path d="M18 6 6 18M6 6l12 12"/></React.Fragment>,
                menu: <React.Fragment><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></React.Fragment>,
                userPlus: <React.Fragment><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="16" x2="22" y1="11" y2="11"/></React.Fragment>,
                arrow: <React.Fragment><path d="M5 12h14M12 5l7 7-7 7"/></React.Fragment>,
                chart: <React.Fragment><path d="M3 3v18h18M7 16v-4M11 16V9M15 16V5M19 16v-7"/></React.Fragment>,
                whatsapp: <React.Fragment><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.414 0 .004 5.408 0 12.046c0 2.121.554 4.191 1.605 6.012L0 24l6.117-1.605a11.847 11.847 0 005.933 1.57h.005c6.632 0 12.042-5.41 12.046-12.048a11.83 11.83 0 00-3.53-8.517"/></React.Fragment>
            };
            const path = paths[name];
            if (!path) return null;
            return (
                <svg viewBox="0 0 24 24" width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {path}
                </svg>
            );
        };

        function App() {
            const [view, setView] = useState('feed'); 
            const [activities, setActivities] = useState([]);
            const [fetching, setFetching] = useState(false);
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [selectedActivity, setSelectedActivity] = useState(null);
            const [loading, setLoading] = useState(false);
            const [submitStatus, setSubmitStatus] = useState(null);
            const [formData, setFormData] = useState({ jenis: 'Laporan', namaAhli: '', tajukAktiviti: '', tarikh: '', lokasi: '', deskripsi: '', whatsapp: '', gambarData: [], passcode: '' });

            const formatDisplayDate = useCallback((dateStr) => {
                if (!dateStr) return "";
                const d = new Date(dateStr);
                return isNaN(d.getTime()) ? dateStr : d.toLocaleDateString('ms-MY', { day: 'numeric', month: 'short', year: 'numeric' });
            }, []);

            const fetchActivities = async () => {
                setFetching(true);
                try {
                    const res = await fetch(SCRIPT_URL);
                    if (!res.ok) throw new Error('Network error');
                    const data = await res.json();
                    if (Array.isArray(data)) {
                        setActivities(data.sort((a, b) => new Date(b.tarikh).getTime() - new Date(a.tarikh).getTime()));
                    }
                } catch (e) { console.error(e); } finally { setFetching(false); }
            };

            useEffect(() => { fetchActivities(); }, []);

            const handleSubmit = async (e, directData = null) => {
                if (e) e.preventDefault();
                const data = directData || formData;
                if (data.passcode !== COMMUNITY_PASSCODE) { setSubmitStatus('wrong_passcode'); return; }
                setLoading(true); setSubmitStatus('sending');
                try {
                    await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(data), mode: 'no-cors' });
                    setSubmitStatus('success');
                    setFormData({ jenis: 'Laporan', namaAhli: '', tajukAktiviti: '', tarikh: '', lokasi: '', deskripsi: '', whatsapp: '', gambarData: [], passcode: '' });
                    setTimeout(fetchActivities, 3000);
                } catch (err) { setSubmitStatus('error'); } finally { setLoading(false); }
            };

            const pastActivities = useMemo(() => activities.filter(a => a.jenis === 'Laporan' || !a.jenis), [activities]);
            const upcomingPromos = useMemo(() => activities.filter(a => a.jenis === 'Promosi'), [activities]);

            return (
                <div className="flex flex-col min-h-screen fade-in text-left">
                    <nav className="bg-white sticky top-0 z-50 border-b border-teal-100 px-4 h-20 flex items-center justify-between shadow-sm">
                        <div className="flex items-center gap-3 cursor-pointer" onClick={() => setView('feed')}>
                            <img src={LOGO_URL} className="w-12 h-12 object-contain" alt="Logo" />
                            <div className="flex flex-col text-left leading-none">
                                <span className="font-black text-teal-800 text-lg uppercase tracking-tight leading-none">ISMA</span>
                                <span className="text-[8px] font-bold text-teal-600 uppercase tracking-widest mt-1 leading-none">Subang Jaya</span>
                            </div>
                        </div>
                        <div className="hidden md:flex gap-2">
                            {['feed', 'share', 'admin'].map(v => (
                                <button key={v} onClick={() => setView(v)} className={`px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${view === v ? 'bg-teal-700 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-50'}`}>
                                    {v === 'feed' ? 'Inspirasi' : v === 'share' ? 'Kongsi' : 'Dashboard'}
                                </button>
                            ))}
                        </div>
                        <button className="md:hidden p-2 text-teal-700" onClick={() => setIsMenuOpen(!isMenuOpen)}><Icon name={isMenuOpen ? "x" : "menu"} size={28}/></button>
                    </nav>

                    <main className="max-w-6xl mx-auto w-full p-6 flex-grow">
                        <div className="text-center mb-16 md:mb-24 py-10">
                            <h1 className="text-4xl md:text-7xl font-black text-slate-800 tracking-tighter mb-6 leading-tight">Portal Aktiviti Komuniti <br/><span className="text-teal-700 text-center">ISMA Subang Jaya</span></h1>
                            <p className="text-slate-500 max-w-2xl mx-auto text-base italic font-medium">"Merapatkan ukhuwah, mendokumentasikan khidmat bakti, dan memberi inspirasi kepada komuniti setempat."</p>
                        </div>

                        {view === 'feed' && (
                            <div className="space-y-24">
                                <section>
                                    <div className="flex justify-between items-center mb-10 border-b-4 border-teal-600/10 pb-4">
                                        <div className="flex flex-col text-left">
                                            <h2 className="text-xl md:text-2xl font-black text-slate-800 uppercase flex items-center gap-3"><Icon name="grid" className="text-teal-600" /> Papan Inspirasi</h2>
                                            <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1">Aktiviti Terkini</span>
                                        </div>
                                        <button onClick={fetchActivities} className="p-3 bg-white border border-slate-200 rounded-2xl text-teal-700 shadow-sm transition-colors"><Icon name="refresh" size={16} className={fetching ? "animate-spin" : ""} /></button>
                                    </div>
                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
                                        {pastActivities.slice(0, 8).map((act, i) => (
                                            <div key={i} onClick={() => setSelectedActivity(act)} className="bg-white rounded-[2rem] overflow-hidden border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all cursor-pointer group text-left">
                                                <div className="h-48 relative overflow-hidden bg-slate-50">
                                                    <img src={act.gambarUrl?.split(',')[0]} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000" alt="" />
                                                    <div className="absolute bottom-3 right-3 bg-teal-700/90 backdrop-blur-md text-white px-3 py-1 rounded-lg text-[8px] font-black uppercase tracking-widest flex items-center gap-2 shadow-lg leading-none">
                                                        <Icon name="calendar" size={10}/> {formatDisplayDate(act.tarikh)}
                                                    </div>
                                                </div>
                                                <div className="p-6 text-left">
                                                    <h3 className="text-sm font-black text-slate-800 mb-2 leading-tight group-hover:text-teal-700 transition-colors line-clamp-2 uppercase leading-none">{act.tajukAktiviti}</h3>
                                                    <p className="text-slate-500 text-[10px] italic line-clamp-2 font-medium">"{act.deskripsi}"</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </section>
                            </div>
                        )}

                        {view === 'share' && (
                            <div className="max-w-2xl mx-auto py-10 animate-in slide-in-from-bottom text-left">
                                <div className="bg-white rounded-[3rem] shadow-2xl overflow-hidden border border-teal-50">
                                    <div className="bg-teal-700 p-10 text-white text-center">
                                        <h2 className="text-2xl font-black uppercase tracking-tight text-white leading-none">Hantar Laporan</h2>
                                    </div>
                                    <form onSubmit={(e) => handleSubmit(e, {...formData, jenis: 'Laporan'})} className="p-8 md:p-12 space-y-6">
                                        {submitStatus === 'success' && <div className="bg-teal-50 text-teal-800 p-5 rounded-2xl flex items-center gap-4"><Icon name="check" className="text-teal-600" /> <span className="text-xs font-black uppercase tracking-widest leading-none">Berjaya Dihantar!</span></div>}
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <input name="namaAhli" required value={formData.namaAhli} onChange={(e) => setFormData({...formData, namaAhli: e.target.value})} className="w-full p-4 bg-slate-50 rounded-xl outline-none" placeholder="Nama Anda" />
                                            <input type="date" name="tarikh" required value={formData.tarikh} onChange={(e) => setFormData({...formData, tarikh: e.target.value})} className="w-full p-4 bg-slate-50 rounded-xl" />
                                        </div>
                                        <input name="tajukAktiviti" required value={formData.tajukAktiviti} onChange={(e) => setFormData({...formData, tajukAktiviti: e.target.value})} className="w-full p-4 bg-slate-50 rounded-xl outline-none" placeholder="Tajuk Aktiviti" />
                                        <textarea name="deskripsi" required rows="4" value={formData.deskripsi} onChange={(e) => setFormData({...formData, deskripsi: e.target.value})} className="w-full p-4 bg-slate-50 rounded-xl outline-none" placeholder="Ringkasan..."></textarea>
                                        <div className="p-6 bg-teal-50 rounded-2xl border border-teal-100">
                                            <input type="password" required value={formData.passcode} onChange={(e) => setFormData({...formData, passcode: e.target.value})} className="w-full p-4 bg-white rounded-xl text-center font-black" placeholder="KOD KOMUNITI" />
                                        </div>
                                        <button disabled={loading} className="w-full bg-teal-700 text-white py-5 rounded-[2rem] font-black uppercase text-sm tracking-widest shadow-xl">
                                            {loading ? "Menghantar..." : "Hantar Laporan"}
                                        </button>
                                    </form>
                                </div>
                            </div>
                        )}

                        {view === 'admin' && (
                            <div className="space-y-12 py-10 text-left animate-in slide-in-from-bottom">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
                                    <div className="bg-white p-8 rounded-[2.5rem] border flex items-center gap-6 shadow-sm">
                                        <Icon name="chart" size={32} className="text-teal-600"/>
                                        <div className="text-left leading-none">
                                            <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1 leading-none text-left">Jumlah Aktiviti</p>
                                            <p className="text-4xl font-black text-slate-800 leading-none text-left">{pastActivities.length}</p>
                                        </div>
                                    </div>
                                    <div className="bg-white p-8 rounded-[2.5rem] border flex items-center gap-6 shadow-sm">
                                        <Icon name="users" size={32} className="text-blue-600"/>
                                        <div className="text-left leading-none">
                                            <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1 leading-none text-left">Ahli Berdaftar</p>
                                            <p className="text-4xl font-black text-slate-800 leading-none text-left">{new Set(pastActivities.map(a => a.namaAhli)).size}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-white rounded-[2.5rem] border overflow-hidden max-w-5xl mx-auto shadow-sm">
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left">
                                            <thead className="bg-slate-50/50 text-[10px] font-black text-slate-400 uppercase tracking-widest text-left">
                                                <tr><th className="p-6">Tarikh</th><th className="p-6">Tajuk</th><th className="p-6 text-center">Status</th></tr>
                                            </thead>
                                            <tbody className="divide-y text-sm">
                                                {activities.map((act, idx) => (
                                                    <tr key={idx} className="hover:bg-teal-50/20 text-left transition-colors">
                                                        <td className="p-6 text-slate-400 font-bold whitespace-nowrap">{formatDisplayDate(act.tarikh)}</td>
                                                        <td className="p-6 text-slate-600 font-medium uppercase">{act.tajukAktiviti}</td>
                                                        <td className="p-6 text-center leading-none"><span className="bg-teal-50 text-teal-700 text-[9px] font-black px-3 py-1 rounded-full border border-teal-100 uppercase leading-none">DIARKIB</span></td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <footer className="bg-slate-900 py-24 border-t border-slate-800 text-center text-white mt-auto">
                        <div className="max-w-6xl mx-auto px-4 text-center">
                            <p className="text-white font-black text-2xl uppercase tracking-tighter mb-2 text-center leading-none">ISMA Subang Jaya</p>
                            <p className="text-[10px] uppercase tracking-[0.6em] text-slate-500 font-black text-center leading-none">Membangun Ummah, Memperkukuh Komuniti</p>
                        </div>
                    </footer>

                    {selectedActivity && (
                        <div className="fixed inset-0 z-[300] bg-black/90 flex items-center justify-center p-4" onClick={() => setSelectedActivity(null)}>
                            <div className="bg-white rounded-[2rem] max-w-lg w-full overflow-hidden flex flex-col shadow-2xl" onClick={e => e.stopPropagation()}>
                                <img src={selectedActivity.gambarUrl?.split(',')[0]} className="w-full h-64 object-cover" alt="Detail" />
                                <div className="p-8 text-left">
                                    <h2 className="text-2xl font-black leading-tight text-slate-800 mb-4 uppercase text-left leading-none">{selectedActivity.tajukAktiviti}</h2>
                                    <p className="text-slate-600 text-sm italic mb-8 text-left leading-relaxed">"{selectedActivity.deskripsi}"</p>
                                    <button onClick={() => setSelectedActivity(null)} className="w-full bg-slate-900 text-white py-4 rounded-xl font-black uppercase text-xs leading-none transition-all">Tutup</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const rootNode = document.getElementById('root');
        if (rootNode) {
            const root = ReactDOM.createRoot(rootNode);
            root.render(<App />);
        }
    </script>
</body>
</html>